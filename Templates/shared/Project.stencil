import ProjectDescription

let organizationName = "{{ organizationName }}"
let bundleIdPrefix = "{{ bundleIdPrefix }}"
let moduleName = "{{ name }}"
let deploymentTarget: DeploymentTargets = .iOS("{{ deploymentTarget }}")
{% if teamId != "" %}let teamID = "{{ teamId }}"{% endif %}

// MARK: - Settings

let baseSettings: SettingsDictionary = [
    "ENABLE_USER_SCRIPT_SANDBOXING": .string("YES"),
    "ENABLE_MODULE_VERIFIER": .string("YES"),
    "SWIFT_STRICT_CONCURRENCY": .string("targeted"){% if teamId != "" %},
    "DEVELOPMENT_TEAM": .string(teamID){% endif %}
]

// MARK: - Project

let project = Project(
    name: moduleName,
    organizationName: organizationName,
    settings: .settings(
        base: baseSettings,
        defaultSettings: .recommended()
    ),
    targets: [
        // MARK: - Shared (Single Target with internal organization)
        .target(
            name: moduleName,
            destinations: .iOS,
            product: .framework,
            bundleId: "\(bundleIdPrefix).\(moduleName.lowercased())",
            deploymentTargets: deploymentTarget,
            buildableFolders: ["Sources"],
            dependencies: [
                .external(name: "ComposableArchitecture"),
                .external(name: "Dependencies")
            ],
            settings: .settings(
                base: baseSettings,
                defaultSettings: .recommended()
            )
        )
    ],
    schemes: [
        .scheme(
            name: moduleName,
            shared: true,
            buildAction: .buildAction(targets: [
                .init(stringLiteral: moduleName)
            ])
        )
    ]
)
