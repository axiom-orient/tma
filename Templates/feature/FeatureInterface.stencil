import SwiftUI
import Dependencies

// MARK: - Feature Builder Protocol

/// Entry point contract for the {{ name }} feature.
public protocol {{ name }}FeatureBuildable: Sendable {
    /// Builds the feature view hierarchy.
    @MainActor
    func build() -> AnyView
}

public extension {{ name }}FeatureBuildable {
    @MainActor
    func eraseToAnyView() -> AnyView { build() }
}

// MARK: - Dependency Key

public enum {{ name }}FeatureBuilderKey: TestDependencyKey {
    public static var testValue: any {{ name }}FeatureBuildable {
        Stub{{ name }}FeatureBuilder()
    }

    #if DEBUG
    public static var previewValue: any {{ name }}FeatureBuildable {
        Stub{{ name }}FeatureBuilder()
    }
    #endif
}

public extension DependencyValues {
    var {{ name | lowerFirstWord }}FeatureBuilder: any {{ name }}FeatureBuildable {
        get { self[{{ name }}FeatureBuilderKey.self] }
        set { self[{{ name }}FeatureBuilderKey.self] = newValue }
    }
}

// MARK: - Test Helpers

private struct Stub{{ name }}FeatureBuilder: {{ name }}FeatureBuildable, Sendable {
    @MainActor
    func build() -> AnyView {
        AnyView(
            VStack(alignment: .leading, spacing: 8) {
                Text("{{ name }} Feature")
                    .font(.headline)
                Text("Stubbed builder for testing/previews")
                    .font(.footnote)
                    .foregroundStyle(.secondary)
            }
            .padding()
        )
    }
}
