import ProjectDescription

let organizationName = "{{ organizationName }}"
let bundleIdPrefix = "{{ bundleIdPrefix }}"
let moduleName = "{{ name }}Feature"
let deploymentTarget: DeploymentTargets = .iOS("{{ deploymentTarget }}")
{% if teamId != "" %}let teamID = "{{ teamId }}"{% endif %}

// MARK: - Settings

let baseSettings: SettingsDictionary = [
    "ENABLE_USER_SCRIPT_SANDBOXING": .string("YES"),
    "ENABLE_MODULE_VERIFIER": .string("YES"),
    "SWIFT_STRICT_CONCURRENCY": .string("targeted"){% if teamId != "" %},
    "DEVELOPMENT_TEAM": .string(teamID){% endif %}
]

// MARK: - Project

let project = Project(
    name: moduleName,
    organizationName: organizationName,
    settings: .settings(
        base: baseSettings,
        defaultSettings: .recommended()
    ),
    targets: [
        // MARK: - Feature (Single Target with internal Interface)
        .target(
            name: moduleName,
            destinations: .iOS,
            product: .staticFramework,
            bundleId: "\(bundleIdPrefix).\(moduleName.lowercased())",
            deploymentTargets: deploymentTarget,
            resources: ["Resources/**"],
            buildableFolders: ["Sources"],
            dependencies: [
                .external(name: "ComposableArchitecture"),
                .external(name: "Dependencies")
                // Add domain/service dependencies here
            ],
            settings: .settings(
                base: baseSettings,
                defaultSettings: .recommended()
            )
        ),

        // Tests Target
        .target(
            name: "\(moduleName)Tests",
            destinations: .iOS,
            product: .unitTests,
            bundleId: "\(bundleIdPrefix).\(moduleName.lowercased()).tests",
            deploymentTargets: deploymentTarget,
            buildableFolders: ["Tests"],
            dependencies: [
                .target(name: moduleName)
            ],
            settings: .settings(
                base: baseSettings,
                defaultSettings: .recommended()
            )
        )
    ],
    schemes: [
        .scheme(
            name: moduleName,
            shared: true,
            buildAction: .buildAction(targets: [
                .init(stringLiteral: moduleName)
            ]),
            testAction: .targets([.init(stringLiteral: "\(moduleName)Tests")])
        )
    ]
)
